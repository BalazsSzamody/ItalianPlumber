default: &default
  PROJECT_NAME: 'ItalianPlumber'
  SCHEME: 'ItalianPlumber'
  BUNDLE_ID: 'com.bszamody.ItalianPlumber'

steps:
  - label: 'Run Tests'
    branches: 'code-climate'
    command: 
      - "echo --- :fastlane: running test"
      - "source ~/.bashrc && fastlane test"
      - "echo --- :codeclimate: generating and uploading coverage results"
      - "buildkite-agent artifact upload xml_report/cobertura.xml"
      - "buildkite-agent artifact upload buildTest.sh"
    env:
      <<: *default
    agents:
      ios: 'build'

  - label: 'Code Climate'
    branches: 'code-climate'
    command:
      - "echo --- :codeclimate: Download Coverage results"
      - "ls"
      - "buildkite-agent artifact download xml_report/cobertura.xml"

    env:
      <<: *default
    agents: 
      ios: 'build'
